<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>AmericasBarometer Labels Guide • lapop</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="AmericasBarometer Labels Guide">
<meta name="description" content="This vignette provides examples of how to use lapop helper functions to access AmericasBarometer question wording and response option labels in R.
">
<meta property="og:description" content="This vignette provides examples of how to use lapop helper functions to access AmericasBarometer question wording and response option labels in R.
">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">lapop</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">2.1.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/lapop-r-labels.html">AmericasBarometer Labels Guide</a></li>
    <li><a class="dropdown-item" href="../articles/lapop-visualization.html">LAPOP Visualization Guide</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>AmericasBarometer Labels Guide</h1>
            
      

      <div class="d-none name"><code>lapop-r-labels.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>This concise guide demonstrates how R users can effectively work with
AmericasBarometer datasets to access variable metadata directly
eliminating the need for external codebooks. While these features are
more readily visible in STATA, they often require specific approaches in
R. The guide outlines:</p>
<ol style="list-style-type: decimal">
<li><p>The multilingual structure and storage of AmericasBarometer data
(including variable labels and value labels).</p></li>
<li><p>How to implement our custom LAPOP Lab functions for seamless
dataset analysis.</p></li>
</ol>
</div>
<div class="section level2">
<h2 id="installing-lapop-lab-package">Installing LAPOP Lab package<a class="anchor" aria-label="anchor" href="#installing-lapop-lab-package"></a>
</h2>
<p>The <code>lapop</code> package contains custom functions to analyze
data and plot figures following the LAPOP Lab’s guidelines.</p>
<p>If you do not have the LAPOP Lab package already installed in your
machine you can install it using the <code>devtools</code> package
below:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Install the LAPOP Lab package:</span></span>
<span><span class="fu">devtools</span><span class="fu">::</span><span class="fu">install_github</span><span class="op">(</span><span class="st">"https://github.com/lapop-central/lapop"</span>, </span>
<span>                         force<span class="op">=</span><span class="cn">TRUE</span>, </span>
<span>                         build_vignettes <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p>After installation is successful, you will need to load the package
into your library:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://lapop-central.github.io/lapop/">lapop</a></span><span class="op">)</span></span>
<span><span class="co"># Note: no need for lapop_fonts() </span></span>
<span><span class="co"># because we are not plotting figures</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="how-lapop-lab-stores-variables-metadata">How LAPOP Lab stores variables metadata?<a class="anchor" aria-label="anchor" href="#how-lapop-lab-stores-variables-metadata"></a>
</h2>
<p>LAPOP Lab’s AmericasBarometer stores variable labels and value labels
in parallel languages (i.e., Spanish/English/Portuguese) directly within
the dataset structure. This allows researchers to access metadata
without external codebooks by:</p>
<p>Embedding language-specific labels as attributes in Stata-formatted
files and to use standardized variable naming conventions that maintain
consistency across survey waves since 2004. Therefore, Metadata is
structured to facilitate longitudinal analysis. The project employs
Stata-formatted datasets (.dta) with embedded metadata, preserving:</p>
<ul>
<li><p>Variable labels (i.e., question wording).</p></li>
<li><p>Value labels (i.e., responses options).</p></li>
<li><p>Missing value codes (i.e., Not Applicated, Don’t Know,
Refused).</p></li>
</ul>
<p>As a result, a key advantage is LAPOP Lab’s active metadata
preservation even when distributing data through third-party platforms
like ICPSR or NORC, the Stata-formatted metadata remains intact,
allowing R/python users to still access labels via the
<code>readstata13</code> package.</p>
</div>
<div class="section level2">
<h2 id="how-to-load-americasbarometer-data-in-r">How to load AmericasBarometer Data in R?<a class="anchor" aria-label="anchor" href="#how-to-load-americasbarometer-data-in-r"></a>
</h2>
<p>The preferred method for loading LAPOP Lab datasets is to use the
<code>read.dta13()</code> function from the <code>readstata13</code>
package. Below, I highlight a key difference between this recommended
approach and two alternative methods commonly used by researchers:
<code><a href="https://haven.tidyverse.org/reference/read_dta.html" class="external-link">haven::read_dta()</a></code> and <code><a href="http://gesistsa.github.io/rio/reference/import.html" class="external-link">rio::import()</a></code>.</p>
<p>In the R programming language, attributes are additional metadata
that can be attached to R objects. Attributes provide a way to store
extra information about an object beyond its basic data structure. To
access the attributes of an object, you can use the <code><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr()</a></code>
or <code><a href="https://rdrr.io/r/base/attributes.html" class="external-link">attributes()</a></code> base functions.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># READSTATA13 PACKAGE (RECOMMENDED FOR LABELS)</span></span>
<span><span class="va">data1</span> <span class="op">&lt;-</span> <span class="fu">read.dta13</span><span class="op">(</span><span class="st">"./BRA 2023 LAPOP AmericasBarometer (v1.0s).dta"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/attributes.html" class="external-link">attributes</a></span><span class="op">(</span><span class="va">data1</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># HAVEN PACKAGE (RECOMMENDED FOR PLOTTING)</span></span>
<span><span class="va">data2</span> <span class="op">&lt;-</span> <span class="fu">read_dta</span><span class="op">(</span><span class="st">"./BRA 2023 LAPOP AmericasBarometer (v1.0s).dta"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/attributes.html" class="external-link">attributes</a></span><span class="op">(</span><span class="va">data2</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># RIO PACKAGE</span></span>
<span><span class="va">data3</span> <span class="op">&lt;-</span> <span class="fu">import</span><span class="op">(</span><span class="st">"./BRA 2023 LAPOP AmericasBarometer (v1.0s).dta"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/attributes.html" class="external-link">attributes</a></span><span class="op">(</span><span class="va">data3</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>The methods <code>haven</code> and <code>rio</code> packages do not
recover all the metadata from <code>dta</code> files. Thereby, we
proceed with the dataset loaded with the <code>readstata13</code>
package.</p>
</div>
<div class="section level2">
<h2 id="americasbarometer-variables-labels-question-wording">AmericasBarometer Variables Labels (Question Wording)<a class="anchor" aria-label="anchor" href="#americasbarometer-variables-labels-question-wording"></a>
</h2>
<p>AmericasBarometer variable labels are stored as <code>notes</code> in
STATA .dta files. We can find them inside the “expansion.fields”
attribute.</p>
<p>The <code>varlabels</code> object created is a nested list (much like
a JSON object) that will contain multilingual notes with the question
wording of each variable. For instance, for the variable
<code>ing4</code> in the <code>Brazil AB 2023</code> dataset will
contain notes with the question wording and lead-in in English, Spanish,
and Portuguese.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">bra23</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Extracting attributes from expasion.fields</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/attributes.html" class="external-link">attributes</a></span><span class="op">(</span><span class="va">bra23</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##  [1] "row.names"        "names"            "datalabel"        "time.stamp"      </span></span>
<span><span class="co">##  [5] "formats"          "types"            "val.labels"       "var.labels"      </span></span>
<span><span class="co">##  [9] "version"          "label.table"      "expansion.fields" "byteorder"       </span></span>
<span><span class="co">## [13] "orig.dim"         "data.label"       "class"</span></span></code></pre>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">varlabels</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span><span class="va">bra23</span>, <span class="st">"expansion.fields"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Printing notes for varibale "ing4"</span></span>
<span><span class="va">varlabels</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grepl</a></span><span class="op">(</span><span class="st">"ing4"</span>, <span class="va">varlabels</span><span class="op">)</span> <span class="op">&amp;</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grepl</a></span><span class="op">(</span><span class="st">"note"</span>, <span class="va">varlabels</span><span class="op">)</span><span class="op">]</span></span></code></pre></div>
<pre><code><span><span class="co">## [[1]]</span></span>
<span><span class="co">## [1] "ing4"  "note0" "7"    </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## [[2]]</span></span>
<span><span class="co">## [1] "ing4"                                                                                                                                                                                                                                                                                                        </span></span>
<span><span class="co">## [2] "note7"                                                                                                                                                                                                                                                                                                       </span></span>
<span><span class="co">## [3] "Ahora, vamos a usar una escalera en donde el número 1 representa \"muy en desacuerdo\" y el número 7 representa \"muy de acuerdo\". Un número entre el 1 y el 7, representa un puntaje intermedio. Le voy a leer algunas frases. Por favor dígame hasta qué punto está de acuerdo o en desacuerdo con ellas."</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## [[3]]</span></span>
<span><span class="co">## [1] "ing4"                                                                                                                                                                                                                                                             </span></span>
<span><span class="co">## [2] "note6"                                                                                                                                                                                                                                                            </span></span>
<span><span class="co">## [3] "Now we will use a ladder where 1 means \"strongly disagree\" and 7 means \"strongly agree.\" A number in between 1 and 7 represents an intermediate score. Now I am going to read some statements. Please tell me to what extent you agree or disagree with them."</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## [[4]]</span></span>
<span><span class="co">## [1] "ing4"                                                                                                                                         </span></span>
<span><span class="co">## [2] "note5"                                                                                                                                        </span></span>
<span><span class="co">## [3] "Democracy may have problems, but it is better than any other form of government. To what extent do you agree or disagree with this statement?"</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## [[5]]</span></span>
<span><span class="co">## [1] "ing4"                                                                                                                                                                                                                                                                      </span></span>
<span><span class="co">## [2] "note4"                                                                                                                                                                                                                                                                     </span></span>
<span><span class="co">## [3] "Agora, vamos usar um cartão em que o ponto 1 representa \"discorda muito\" e o ponto 7 representa \"concorda muito\". Um número entre 1 e 7, representa uma pontuação intermediária. Agora vou ler algumas frases. Por favor, me diga o quanto concorda ou discorda delas."</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## [[6]]</span></span>
<span><span class="co">## [1] "ing4"                                                                                                                              </span></span>
<span><span class="co">## [2] "note3"                                                                                                                             </span></span>
<span><span class="co">## [3] "A democracia tem seus problemas, mas é melhor que qualquer outra forma de governo. Até que ponto concorda ou discorda desta frase?"</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## [[7]]</span></span>
<span><span class="co">## [1] "ing4"                                                                                                                                                         </span></span>
<span><span class="co">## [2] "note1"                                                                                                                                                        </span></span>
<span><span class="co">## [3] "Puede que la democracia tenga problemas, pero es mejor que cualquier otra forma de gobierno. ¿Hasta qué punto está de acuerdo o en desacuerdo con esta frase?"</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## [[8]]</span></span>
<span><span class="co">## [1] "ing4"                                                                                                                                          </span></span>
<span><span class="co">## [2] "note2"                                                                                                                                         </span></span>
<span><span class="co">## [3] "Democracy may have problems, but it is better than any other form of government.  To what extent do you agree or disagree with this statement?"</span></span></code></pre>
</div>
<div class="section level2">
<h2 id="how-do-i-find-the-correct-language-labels">How do I find the correct language labels?<a class="anchor" aria-label="anchor" href="#how-do-i-find-the-correct-language-labels"></a>
</h2>
<p>It is important to keep in mind that note numbers may change across
countries datasets and years depending on the language the survey was
fielded. For Brazil, it is Brazilian-Portuguese, whereas in most other
countries it is in Spanish but also in English like in Jamaica.</p>
<p>A streamlined approach for users who want to quickly find the values
of the notes on variable labels without assigning to the dataset would
be assessing those notes directly with a combination of
<code><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply()</a></code> and <code><a href="https://rdrr.io/r/base/funprog.html" class="external-link">Filter()</a></code> functions from base R,
or also <code>compact()</code> and <code>map()</code> functions from the
<code>purrr</code> package.</p>
<p>Both approaches extract the third element (x[3]) from each list in
the “expansion.fields” attribute of the dataset, but only if the first
element (x[1]) equals “ing4” (i.e., the variable of interest). Both
produce a semi-structured list of matching third nested elements.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Base R approach:</span></span>
<span><span class="co"># The base R version uses lapply to iterate over the list and returns NULL when </span></span>
<span><span class="co"># the condition isn't met, then Filter(Negate(is.null), ...) removes those NULLs.</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/funprog.html" class="external-link">Filter</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/funprog.html" class="external-link">Negate</a></span><span class="op">(</span><span class="va">is.null</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span><span class="va">bra23</span>, <span class="st">"expansion.fields"</span><span class="op">)</span>, </span>
<span>  <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="va">x</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">==</span> <span class="st">"ing4"</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>note_id <span class="op">=</span> <span class="va">x</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>, note_value <span class="op">=</span> <span class="va">x</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [[1]]</span></span>
<span><span class="co">## [[1]]$note_id</span></span>
<span><span class="co">## [1] "_lang_l_en"</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## [[1]]$note_value</span></span>
<span><span class="co">## [1] "ing4_en"</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## [[2]]</span></span>
<span><span class="co">## [[2]]$note_id</span></span>
<span><span class="co">## [1] "_lang_v_en"</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## [[2]]$note_value</span></span>
<span><span class="co">## [1] "Support for democracy"</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## [[3]]</span></span>
<span><span class="co">## [[3]]$note_id</span></span>
<span><span class="co">## [1] "note0"</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## [[3]]$note_value</span></span>
<span><span class="co">## [1] "7"</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## [[4]]</span></span>
<span><span class="co">## [[4]]$note_id</span></span>
<span><span class="co">## [1] "note7"</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## [[4]]$note_value</span></span>
<span><span class="co">## [1] "Ahora, vamos a usar una escalera en donde el número 1 representa \"muy en desacuerdo\" y el número 7 representa \"muy de acuerdo\". Un número entre el 1 y el 7, representa un puntaje intermedio. Le voy a leer algunas frases. Por favor dígame hasta qué punto está de acuerdo o en desacuerdo con ellas."</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## [[5]]</span></span>
<span><span class="co">## [[5]]$note_id</span></span>
<span><span class="co">## [1] "note6"</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## [[5]]$note_value</span></span>
<span><span class="co">## [1] "Now we will use a ladder where 1 means \"strongly disagree\" and 7 means \"strongly agree.\" A number in between 1 and 7 represents an intermediate score. Now I am going to read some statements. Please tell me to what extent you agree or disagree with them."</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## [[6]]</span></span>
<span><span class="co">## [[6]]$note_id</span></span>
<span><span class="co">## [1] "note5"</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## [[6]]$note_value</span></span>
<span><span class="co">## [1] "Democracy may have problems, but it is better than any other form of government. To what extent do you agree or disagree with this statement?"</span></span></code></pre>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># purrr package approach</span></span>
<span><span class="co">#  The purrr version uses map() to do the same, and also remove NULL results. </span></span>
<span><span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map_dfr.html" class="external-link">map_dfr</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span><span class="va">bra23</span>, <span class="st">"expansion.fields"</span><span class="op">)</span>, <span class="op">~</span> <span class="op">{</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="va">.x</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">==</span> <span class="st">"ing4"</span><span class="op">)</span> </span>
<span>    <span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span>note_id <span class="op">=</span> <span class="va">.x</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>, note_value <span class="op">=</span> <span class="va">.x</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 14 × 2</span></span></span>
<span><span class="co">##    note_id         note_value                                                   </span></span>
<span><span class="co">##    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>           <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                                                        </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 1</span> _lang_l_en      <span style="color: #949494;">"</span>ing4_en<span style="color: #949494;">"</span>                                                    </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 2</span> _lang_v_en      <span style="color: #949494;">"</span>Support for democracy<span style="color: #949494;">"</span>                                      </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 3</span> note0           <span style="color: #949494;">"</span>7<span style="color: #949494;">"</span>                                                          </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 4</span> note7           <span style="color: #949494;">"</span>Ahora, vamos a usar una escalera en donde el número 1 repre…</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 5</span> note6           <span style="color: #949494;">"</span>Now we will use a ladder where 1 means \"strongly disagree\…</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 6</span> note5           <span style="color: #949494;">"</span>Democracy may have problems, but it is better than any othe…</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 7</span> note4           <span style="color: #949494;">"</span>Agora, vamos usar um cartão em que o ponto 1 representa \"d…</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 8</span> note3           <span style="color: #949494;">"</span>A democracia tem seus problemas, mas é melhor que qualquer …</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 9</span> _lang_l_default <span style="color: #949494;">"</span>labels2670<span style="color: #949494;">"</span>                                                 </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">10</span> _lang_v_default <span style="color: #949494;">"</span>ING4. A democracia tem seus problemas, mas é melhor que qua…</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">11</span> note1           <span style="color: #949494;">"</span>Puede que la democracia tenga problemas, pero es mejor que …</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">12</span> note2           <span style="color: #949494;">"</span>Democracy may have problems, but it is better than any othe…</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">13</span> _lang_v_pt      <span style="color: #949494;">"</span>Apoio à democracia<span style="color: #949494;">"</span>                                         </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">14</span> _lang_l_pt      <span style="color: #949494;">"</span>ing4_pt<span style="color: #949494;">"</span></span></span></code></pre>
<p>To ease the researchers and analysts job, LAPOP Lab developed custom
functions to deal with those labels in R. First, we will use
<code>lpr_extract_notes</code> to transform the nested lists into a long
dataframe format that will contain 3 columns:
<code>variable_name</code>, <code>note_id</code>, and
<code>note_value</code></p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Extract AB notes</span></span>
<span><span class="va">notes</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/lpr_extract_notes.html">lpr_extract_notes</a></span><span class="op">(</span><span class="va">varlabels</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">notes</span>, n <span class="op">=</span> <span class="fl">10</span><span class="op">)</span> <span class="co"># columns names</span></span></code></pre></div>
<pre><code><span><span class="co">##    variable_name    note_id                       note_value</span></span>
<span><span class="co">## 1         strata _lang_l_en                        strata_en</span></span>
<span><span class="co">## 2         strata _lang_v_en                    Survey strata</span></span>
<span><span class="co">## 3            q1n _lang_l_en                           q1n_en</span></span>
<span><span class="co">## 4            q1n _lang_v_en Gender determined by interviewer</span></span>
<span><span class="co">## 5           q1tb _lang_l_en                          q1tb_en</span></span>
<span><span class="co">## 6           q1tb _lang_v_en                           Gender</span></span>
<span><span class="co">## 7          q1tcb _lang_l_en                         q1tcb_en</span></span>
<span><span class="co">## 8          q1tcb _lang_v_en                           Gender</span></span>
<span><span class="co">## 9          q1tca _lang_l_en                         q1tca_en</span></span>
<span><span class="co">## 10         q1tca _lang_v_en                           Gender</span></span></code></pre>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">notes</span><span class="op">$</span><span class="va">note_id</span><span class="op">)</span> <span class="co"># note information available!</span></span></code></pre></div>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">##     _lang_l_default          _lang_l_en          _lang_l_pt     _lang_v_default </span></span>
<span><span class="co">##                 190                1332                1332                 202 </span></span>
<span><span class="co">##          _lang_v_en          _lang_v_pt            destring        destring_cmd </span></span>
<span><span class="co">##                1321                1320                   7                   7 </span></span>
<span><span class="co">##               note0               note1              note10              note11 </span></span>
<span><span class="co">##                 861                 846                   7                   6 </span></span>
<span><span class="co">##              note12              note13               note2               note3 </span></span>
<span><span class="co">##                   1                   1                 833                 265 </span></span>
<span><span class="co">##               note4               note5               note6               note7 </span></span>
<span><span class="co">##                 189                 172                 134                  91 </span></span>
<span><span class="co">##               note8               note9 spss_variable_label </span></span>
<span><span class="co">##                  68                  25                   3</span></span></code></pre>
<p>After extracting the notes, one can assign variable labels to their
preferred language as attributes to the dataset using another LAPOP Lab
function called <code><a href="../reference/lpr_set_attr.html">lpr_set_attr()</a></code> and than access it during
data analysis without the need of an accompanying codebook.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># English</span></span>
<span><span class="va">bra23</span><span class="op">&lt;-</span><span class="fu"><a href="../reference/lpr_set_attr.html">lpr_set_attr</a></span><span class="op">(</span><span class="va">bra23</span>, <span class="va">notes</span>, </span>
<span>                    noteid <span class="op">=</span> <span class="st">"note2"</span>, </span>
<span>                    attribute_name <span class="op">=</span> <span class="st">"qwording_en"</span><span class="op">)</span> </span>
<span><span class="co"># Spanish</span></span>
<span><span class="va">bra23</span><span class="op">&lt;-</span><span class="fu"><a href="../reference/lpr_set_attr.html">lpr_set_attr</a></span><span class="op">(</span><span class="va">bra23</span>, <span class="va">notes</span>, </span>
<span>                    noteid <span class="op">=</span> <span class="st">"note1"</span>, </span>
<span>                    attribute_name <span class="op">=</span> <span class="st">"qwording_es"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Portuguese</span></span>
<span><span class="va">bra23</span><span class="op">&lt;-</span><span class="fu"><a href="../reference/lpr_set_attr.html">lpr_set_attr</a></span><span class="op">(</span><span class="va">bra23</span>, <span class="va">notes</span>, </span>
<span>                    noteid <span class="op">=</span> <span class="st">"note3"</span>, </span>
<span>                    attribute_name <span class="op">=</span> <span class="st">"qwording_pt"</span><span class="op">)</span> </span>
<span></span>
<span><span class="co"># Printing languages</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span><span class="va">bra23</span><span class="op">$</span><span class="va">ing4</span>, <span class="st">"qwording_en"</span><span class="op">)</span> <span class="co"># English</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "Democracy may have problems, but it is better than any other form of government.  To what extent do you agree or disagree with this statement?"</span></span></code></pre>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span><span class="va">bra23</span><span class="op">$</span><span class="va">ing4</span>, <span class="st">"qwording_es"</span><span class="op">)</span> <span class="co"># Spanish</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "Puede que la democracia tenga problemas, pero es mejor que cualquier otra forma de gobierno. ¿Hasta qué punto está de acuerdo o en desacuerdo con esta frase?"</span></span></code></pre>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span><span class="va">bra23</span><span class="op">$</span><span class="va">ing4</span>, <span class="st">"qwording_pt"</span><span class="op">)</span> <span class="co"># Portuguese</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "A democracia tem seus problemas, mas é melhor que qualquer outra forma de governo. Até que ponto concorda ou discorda desta frase?"</span></span></code></pre>
</div>
<div class="section level2">
<h2 id="americasbarometer-values-labels-response-options">AmericasBarometer Values Labels (Response Options)<a class="anchor" aria-label="anchor" href="#americasbarometer-values-labels-response-options"></a>
</h2>
<p>AmericasBarometer’s values labels (i.e., response options)
differently from the variable labels are stored inside the “label.table”
attribute. To extract them we will use another LAPOP Lab custom function
called <code>lpr_format_labels</code> that will set up the response
options as an attribute across languages. Default language is English
and default attribute name is <code>roslabel</code> but the function
allows custom attribute names as shown below:</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">bra23</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/lpr_set_ros.html">lpr_set_ros</a></span><span class="op">(</span><span class="va">bra23</span><span class="op">)</span> <span class="co"># Default English</span></span>
<span></span>
<span><span class="va">bra23</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/lpr_set_ros.html">lpr_set_ros</a></span><span class="op">(</span><span class="va">bra23</span>, lang_id <span class="op">=</span> <span class="st">"es"</span>, </span>
<span>                     attribute_name <span class="op">=</span> <span class="st">"respuestas"</span><span class="op">)</span> <span class="co"># Spanish</span></span>
<span></span>
<span><span class="va">bra23</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/lpr_set_ros.html">lpr_set_ros</a></span><span class="op">(</span><span class="va">bra23</span>, lang_id <span class="op">=</span> <span class="st">"pt"</span>, </span>
<span>                     attribute_name <span class="op">=</span> <span class="st">"ROsLabels_pt"</span><span class="op">)</span> <span class="co"># Portuguese</span></span>
<span></span>
<span><span class="co"># Printing ROs</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span><span class="va">bra23</span><span class="op">$</span><span class="va">ing4</span>, <span class="st">"roslabel"</span><span class="op">)</span> <span class="co"># English</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "Response Options: (1) Strongly disagree (7) Strongly agree"</span></span></code></pre>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span><span class="va">bra23</span><span class="op">$</span><span class="va">ing4</span>, <span class="st">"respuestas"</span><span class="op">)</span> <span class="co"># Spanish</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "Opciones de Respuesta: (1) Muy en desacuerdo (7) Muy de acuerdo"</span></span></code></pre>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span><span class="va">bra23</span><span class="op">$</span><span class="va">ing4</span>, <span class="st">"ROsLabels_pt"</span><span class="op">)</span> <span class="co"># Portuguese</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "Alternativas de Resposta: (1) Discorda muito (7) Concorda muito"</span></span></code></pre>
<p><br></p>
</div>
<div class="section level2">
<h2 id="takeaways-tldr">Takeaways (TLDR)<a class="anchor" aria-label="anchor" href="#takeaways-tldr"></a>
</h2>
<p><br></p>
<div class="section level3">
<h3 id="data-structure">Data Structure<a class="anchor" aria-label="anchor" href="#data-structure"></a>
</h3>
<p>AmericasBarometer datasets are distributed in Stata .dta format with
multilingual metadata (question wording and response options) embedded
as attributes. These support cross-national and longitudinal
comparability.</p>
<p><br></p>
</div>
<div class="section level3">
<h3 id="preferred-loading-method">Preferred Loading Method<a class="anchor" aria-label="anchor" href="#preferred-loading-method"></a>
</h3>
<p>Use the readstata13::read.dta13() function to preserve full metadata
structure. Other methods such as <code><a href="https://haven.tidyverse.org/reference/read_dta.html" class="external-link">haven::read_dta()</a></code> or
<code><a href="http://gesistsa.github.io/rio/reference/import.html" class="external-link">rio::import()</a></code> often fail to import these critical
attributes.</p>
<p><br></p>
</div>
<div class="section level3">
<h3 id="variable-labels-question-wording">Variable Labels (Question Wording):<a class="anchor" aria-label="anchor" href="#variable-labels-question-wording"></a>
</h3>
<p>Stored in the “expansion.fields” attribute. Use the custom
<code><a href="../reference/lpr_extract_notes.html">lpr_extract_notes()</a></code> function to convert this into a tidy
data frame.</p>
<p>Assign preferred language labels to each variable with
<code><a href="../reference/lpr_set_attr.html">lpr_set_attr()</a></code> using the appropriate noteid.</p>
<p><br></p>
</div>
<div class="section level3">
<h3 id="value-labels-response-options">Value Labels (Response Options):<a class="anchor" aria-label="anchor" href="#value-labels-response-options"></a>
</h3>
<p>Stored in the “label.table” attribute. Use <code><a href="../reference/lpr_set_ros.html">lpr_set_ros()</a></code>
to assign these response labels as attributes in English, Spanish, or
Portuguese.</p>
<p><br></p>
</div>
<div class="section level3">
<h3 id="quick-access-options">Quick Access Options<a class="anchor" aria-label="anchor" href="#quick-access-options"></a>
</h3>
<p>For advanced users, the guide also demonstrates streamlined methods
using <code><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply()</a></code> and <code><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">purrr::map()</a></code> to quickly
view variable labels without modifying the dataset.</p>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Robert Vidigal.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
